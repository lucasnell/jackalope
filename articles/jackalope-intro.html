<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Intro to jackalope • jackalope</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Intro to jackalope">
<meta property="og:description" content="jackalope">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">jackalope</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.1.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/jackalope-intro.html">Intro to jackalope</a>
    </li>
    <li>
      <a href="../articles/sub-models.html">Models of nucleotide substitution</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lucasnell/jackalope/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Intro to jackalope</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/lucasnell/jackalope/blob/master/vignettes/jackalope-intro.Rmd"><code>vignettes/jackalope-intro.Rmd</code></a></small>
      <div class="hidden name"><code>jackalope-intro.Rmd</code></div>

    </div>

    
    
<p>This document provides brief examples of how <code>jackalope</code> can be used to generate sequencing data that can inform some common sampling decisions for HTS studies.</p>
<div id="generating-reference-genome" class="section level2">
<h2 class="hasAnchor">
<a href="#generating-reference-genome" class="anchor"></a>Generating reference genome</h2>
<p>Here, I’ll show how to generate a reference genome based on an existing assembly or via simulated DNA sequences.</p>
<p>To show how an existing assembly is read in <code>jackalope</code>, the code below processes the assembly for <em>Drosophila melanogaster</em> (version 6.27) downloaded from <a href="https://flybase.org" class="uri">https://flybase.org</a>. It reads the compressed FASTA file, filters out scaffolds by using a size threshold, removes the Y chromosome (to avoid having both an X and Y in the same haplotype), and merges the left and right arms of chromosomes 2 and 3. It lastly sets the names of chromosomes 2 and 3 to be <code>"2"</code> and <code>"3"</code>, respectively.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="no">ref</span> <span class="kw">&lt;-</span> <span class="fu">read_fasta</span>(<span class="st">"dmel-6.27.fasta.gz"</span>, <span class="kw">cut_names</span> <span class="kw">=</span> <span class="fl">TRUE</span>)
<span class="no">ref</span>$<span class="fu">filter_chroms</span>(<span class="fl">1e6</span>, <span class="kw">method</span> <span class="kw">=</span> <span class="st">"size"</span>)
<span class="no">ref</span>$<span class="fu">rm_chroms</span>(<span class="st">"Y"</span>)
<span class="no">ref</span>$<span class="fu">merge_chroms</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"2L"</span>, <span class="st">"2R"</span>))
<span class="no">ref</span>$<span class="fu">merge_chroms</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"3L"</span>, <span class="st">"3R"</span>))
<span class="no">names</span> <span class="kw">&lt;-</span> <span class="no">ref</span>$<span class="fu">chrom_names</span>()
<span class="no">names</span>[<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"^2"</span>, <span class="no">names</span>)] <span class="kw">&lt;-</span> <span class="st">"2"</span>
<span class="no">names</span>[<span class="fu"><a href="https://rdrr.io/r/base/grep.html">grepl</a></span>(<span class="st">"^3"</span>, <span class="no">names</span>)] <span class="kw">&lt;-</span> <span class="st">"3"</span>
<span class="no">ref</span>$<span class="fu">set_names</span>(<span class="no">names</span>)</pre></body></html></div>
<p>For the rest of the document, I will use a simulated genome for simplicity (and so that I don’t have to store the <em>D. melanogaster</em> genome inside this package). Here is how I simulated a genome of size <span class="math inline">\(\sim 1\)</span> kb split among 4 chromosomes, with the same names as the chromosomes in the <em>D. melanogaster</em> genome:</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="no">ref</span> <span class="kw">&lt;-</span> <span class="fu">create_genome</span>(<span class="kw">n_chroms</span> <span class="kw">=</span> <span class="fl">4</span>,
                     <span class="kw">len_mean</span> <span class="kw">=</span> <span class="fl">1e3</span> / <span class="fl">4</span>,
                     <span class="kw">len_sd</span> <span class="kw">=</span> <span class="fl">10</span>)
<span class="no">ref</span>$<span class="fu">set_names</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">2</span>:<span class="fl">4</span>, <span class="st">"X"</span>))</pre></body></html></div>
<p>This resulted in the following <code>ref_genome</code> object:</p>
<pre><code>#&gt; &lt; Set of 4 chromosomes &gt;
#&gt; # Total size: 985 bp
#&gt;   name                             chromosome                             length
#&gt; 2          GAAATCATGTCTTATAAAACGCCAAATC...TCCCCGCTTTCAAGACAGTCTCCTCGAC       252
#&gt; 3          TCCGTGATCATGCACAAGCATTGCAGTT...TCTAACGGGCGTCGGGCGAATGCTCGCA       240
#&gt; 4          CACGCGAGCTTACTATTGGTAATGCCTT...CACTTCGGAAGTCAGTTACCAGCTCCTC       253
#&gt; X          AGTCGATCGCAGACCGTCCTCCTGTAAG...ACACGTCACAGCCACGAAGGCTCACGGT       240</code></pre>
<p>For the examples below, we’ll pretend this is our <em>D. melanogaster</em> genome.</p>
</div>
<div id="molecular-evolution-information" class="section level2">
<h2 class="hasAnchor">
<a href="#molecular-evolution-information" class="anchor"></a>Molecular evolution information</h2>
<p>To generate variant haplotypes based on our reference genome, we need molecular evolution information (unless passing a Variant Call Format, or VCF, file). For molecular-evolution information, I used the JC69 model for simplicity. Mutation rates were chosen from the <code>evo_rates</code> object present inside <code>jackalope</code>, which stores Table 1 from <a href="http://dx.doi.org/10.1534/g3.116.030890">Sung et al. (2016)</a>. The substitution and indel rates were the values from <code>evo_rates</code> specific to <em>D. melanogaster</em>. The <code>mu</code> parameter to <code>sub_JC69</code> function was set to <code>NULL</code> because the default behavior of all substitution-model functions in <code>jackalope</code> is to scale rate matrices such that branch lengths are in units of substitutions per site. In this case, I don’t want to scale rate matrices because our branch lengths will be in generations. <a href="https://doi.org/10.1093/nar/gkg745">Zhang and Gerstein (2003)</a> found a 1 to 2.90 ratio of insertions to deletions, and described relative rates of indels of various sizes using a power-law relationship. To approximate the distributions they described, relative rates were derived from a Lavalette distribution with <span class="math inline">\(L = 60\)</span> and <span class="math inline">\(a = 1.60\)</span> for insertions and <span class="math inline">\(a = 1.51\)</span> for deletions. The <span class="math inline">\(\theta\)</span> parameter is the population-scaled mutation rate, which we can get directly from <code>evo_rates</code> for <em>D. melanogaster</em>. Lastly, <span class="math inline">\(N_0\)</span> is the effective population size for <em>D. melanogaster</em>, which is used in a few instances below because <code>scrm</code> outputs branch lengths in units of <span class="math inline">\(4 N_0\)</span> generations.</p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">sub_rate</span> <span class="kw">&lt;-</span> <span class="no">evo_rates</span>$<span class="no">subs</span>[<span class="no">evo_rates</span>$<span class="no">species</span> <span class="kw">==</span> <span class="st">"Drosophila melanogaster"</span>]
<span class="no">indel_rate</span> <span class="kw">&lt;-</span> <span class="no">evo_rates</span>$<span class="no">indels</span>[<span class="no">evo_rates</span>$<span class="no">species</span> <span class="kw">==</span> <span class="st">"Drosophila melanogaster"</span>]
<span class="co"># Because both are in units of 10^-10 events per site per generation:</span>
<span class="no">sub_rate</span> <span class="kw">&lt;-</span> <span class="no">sub_rate</span> * <span class="fl">1e-10</span>
<span class="no">indel_rate</span> <span class="kw">&lt;-</span> <span class="no">indel_rate</span> * <span class="fl">1e-10</span>

<span class="no">sub</span> <span class="kw">&lt;-</span> <span class="fu">sub_JC69</span>(<span class="kw">lambda</span> <span class="kw">=</span> <span class="no">sub_rate</span>, <span class="kw">mu</span> <span class="kw">=</span> <span class="kw">NULL</span>)
<span class="no">ins</span> <span class="kw">&lt;-</span> <span class="fu">indels</span>(<span class="kw">rate</span> <span class="kw">=</span> <span class="no">indel_rate</span>, <span class="kw">max_length</span> <span class="kw">=</span> <span class="fl">60</span>,<span class="kw">a</span> <span class="kw">=</span> <span class="fl">1.60</span>)
<span class="no">del</span> <span class="kw">&lt;-</span> <span class="fu">indels</span>(<span class="kw">rate</span> <span class="kw">=</span> <span class="no">indel_rate</span>, <span class="kw">max_length</span> <span class="kw">=</span> <span class="fl">60</span>, <span class="kw">a</span> <span class="kw">=</span> <span class="fl">1.51</span>)

<span class="no">theta</span> <span class="kw">&lt;-</span> <span class="no">evo_rates</span>[<span class="no">evo_rates</span>$<span class="no">species</span> <span class="kw">==</span> <span class="st">"Drosophila melanogaster"</span>,<span class="st">"theta_s"</span>]

<span class="co"># Originally in units of 1e6 individuals</span>
<span class="no">N0</span> <span class="kw">&lt;-</span> <span class="no">evo_rates</span>[<span class="no">evo_rates</span>$<span class="no">species</span> <span class="kw">==</span> <span class="st">"Drosophila melanogaster"</span>, <span class="st">"Ne"</span>] * <span class="fl">1e6</span></pre></body></html></div>
<p>When generating any haplotypes below, these objects will be used inside <code>create_haplotypes</code> to specify molecular evolution information.</p>
</div>
<div id="assembling-a-genome" class="section level2">
<h2 class="hasAnchor">
<a href="#assembling-a-genome" class="anchor"></a>Assembling a genome</h2>
<div id="based-on-a-reference" class="section level3">
<h3 class="hasAnchor">
<a href="#based-on-a-reference" class="anchor"></a>Based on a reference</h3>
<p>The examples here produce FASTQ files from the known reference assembly that could test strategies for how to assemble a similar genome using HTS data.</p>
<p>The first strategy is to use only PacBio sequencing. The PacBio Sequel system produces up to 500,000 reads per Single Molecule, Real-Time (SMRT) cell, so you could run the following for two cells (with the file <code>pacbio_R1.fq</code> as output):</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="fu">pacbio</span>(<span class="no">ref</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"pacbio"</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">2</span> * <span class="fl">500e3</span>)</pre></body></html></div>
<p>An alternative, hybrid strategy uses 1 SMRT cell of PacBio sequencing and 1 lane (<span class="math inline">\(\sim 500\)</span> million reads) of <span class="math inline">\(2 \times 100\)</span>bp Illumina sequencing on the HiSeq 2500 system (the default Illumina system in <code>jackalope</code>):</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="fu">pacbio</span>(<span class="no">ref</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"pacbio"</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">500e3</span>)
<span class="fu">illumina</span>(<span class="no">ref</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"illumina"</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">500e6</span>, <span class="kw">paired</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">read_length</span> <span class="kw">=</span> <span class="fl">100</span>)</pre></body></html></div>
<p>The last strategy combines 1 lane of <span class="math inline">\(2 \times 100\)</span>bp Illumina HiSeq 2500 sequencing with 1 flow cell of <span class="math inline">\(2 \times 250\)</span>bp mate-pair sequencing on an Illumina MiSeq v3. The mate-pair sequencing uses longer fragments (defaults are mean of 400 and standard deviation of 100) to better cover highly repetitive regions.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="fu">illumina</span>(<span class="no">ref</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"ill_pe"</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">500e6</span>, <span class="kw">paired</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">read_length</span> <span class="kw">=</span> <span class="fl">100</span>)
<span class="fu">illumina</span>(<span class="no">ref</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"ill_mp"</span>, <span class="kw">seq_sys</span> <span class="kw">=</span> <span class="st">"MSv3"</span>,
         <span class="kw">read_length</span> <span class="kw">=</span> <span class="fl">250</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">50e6</span>, <span class="kw">matepair</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">frag_mean</span> <span class="kw">=</span> <span class="fl">3000</span>, <span class="kw">frag_sd</span> <span class="kw">=</span> <span class="fl">500</span>)</pre></body></html></div>
<p>These data could then be used to compare genome assembly performance between the strategies above, or between programs within a given strategy. Extensions of these tests include adjusting sequencing depth, sequencing platform, and error rates.</p>
</div>
<div id="based-on-a-diploid-individual" class="section level3">
<h3 class="hasAnchor">
<a href="#based-on-a-diploid-individual" class="anchor"></a>Based on a diploid individual</h3>
<p>For diploid species, scientists won’t be sampling a haploid reference, and heterozygosity can be a real problem for the assembly process. So below I’ll show you how to simulate a diploid individual and create reads based on that. I’ll just show the hybrid assembly strategy, but the others simply differ in the sequencing step as shown above.</p>
<p>First, we’ll simulate two haplotypes based on the <span class="math inline">\(\theta\)</span> (population-scaled mutation rate) and the other molecular evolution information for <em>D. melanogaster</em> we got from the <code>evo_rates</code> object earlier. I’m also renaming the haplotypes.</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="no">haps</span> <span class="kw">&lt;-</span> <span class="fu">create_haplotypes</span>(<span class="no">ref</span>, <span class="fu">haps_theta</span>(<span class="kw">theta</span> <span class="kw">=</span> <span class="no">theta</span>, <span class="kw">n_haps</span> <span class="kw">=</span> <span class="fl">2</span>),
                          <span class="no">sub</span>, <span class="no">ins</span>, <span class="no">del</span>)
<span class="no">haps</span>$<span class="fu">set_names</span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A"</span>, <span class="st">"B"</span>))</pre></body></html></div>
<p>This results in the following <code>haplotypes</code> object:</p>
<pre><code>#&gt;                               &lt;&lt; haplotypes object &gt;&gt;
#&gt; # Haplotypes: 2
#&gt; # Mutations: 15
#&gt; 
#&gt;                           &lt;&lt; Reference genome info: &gt;&gt;
#&gt; &lt; Set of 4 chromosomes &gt;
#&gt; # Total size: 985 bp
#&gt;   name                             chromosome                             length
#&gt; 2          GAAATCATGTCTTATAAAACGCCAAATC...TCCCCGCTTTCAAGACAGTCTCCTCGAC       252
#&gt; 3          TCCGTGATCATGCACAAGCATTGCAGTT...TCTAACGGGCGTCGGGCGAATGCTCGCA       240
#&gt; 4          CACGCGAGCTTACTATTGGTAATGCCTT...CACTTCGGAAGTCAGTTACCAGCTCCTC       253
#&gt; X          AGTCGATCGCAGACCGTCCTCCTGTAAG...ACACGTCACAGCCACGAAGGCTCACGGT       240</code></pre>
<p>We generate 1 SMRT cell of PacBio sequencing and 1 lane of <span class="math inline">\(2 \times 100\)</span>bp Illumina sequencing on the HiSeq 2500 system as before, except using the new <code>haps</code> object instead of <code>ref</code>:</p>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="fu">pacbio</span>(<span class="no">haps</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"pacbio"</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">500e3</span>)
<span class="fu">illumina</span>(<span class="no">haps</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"illumina"</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">500e6</span>, <span class="kw">paired</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">read_length</span> <span class="kw">=</span> <span class="fl">100</span>)</pre></body></html></div>
<p>If we want to save the information for these haplotypes, we can output FASTA files (one per haplotype) or a VCF file:</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="fu">write_fasta</span>(<span class="no">haps</span>, <span class="st">"haps"</span>)
<span class="fu">write_vcf</span>(<span class="no">haps</span>, <span class="st">"haps"</span>, <span class="kw">sample_matrix</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span>(<span class="fl">1</span>, <span class="fl">2</span>))</pre></body></html></div>
<p>This would result in the following files being generated: <code>haps__A.fa</code>, <code>haps__B.fa</code>, and <code>haps.vcf</code>. The <code>sample_matrix</code> argument to <code>write_vcf</code> states that the first two (i.e., all) haplotypes are from the first (and only) sample. These data could test different assembly strategies, similar to the above section, except that, for diploid organisms, it includes heterozygosity. Increasing the <span class="math inline">\(\theta\)</span> parameter will result in more heterozygosity, which is an obvious extension of these tests.</p>
</div>
</div>
<div id="estimating-divergence-between-populations" class="section level2">
<h2 class="hasAnchor">
<a href="#estimating-divergence-between-populations" class="anchor"></a>Estimating divergence between populations</h2>
<p>Here, I will demonstrate how to generate population-genomic data of a type that might be used to estimate the divergence between two populations. I first use the <code>scrm</code> package to conduct coalescent simulations that will generate segregating sites for 10 variant haplotypes from the reference genome. Five of the haplotypes are from one population, five from another. The symmetrical migration rate is 100 individuals per generation. I used a recombination rate of 1 (the expected number of recombinations on the locus per <span class="math inline">\(4 N_0\)</span> generations). I specify the recombination rate and chromosome size for <code>scrm</code> using the command <code>-r 1 C</code> for chromosome size <code>C</code>. I used the population-scaled mutation rate for <em>D. melanogaster</em>, scaled such that the mutation rate (<span class="math inline">\(\mu\)</span>) is in units of mutations per <span class="math inline">\(4 N_0\)</span> generations, where <span class="math inline">\(N_0\)</span> is the population size. For <span class="math inline">\(N_0\)</span>, I’m using the effective population size for <em>D. melanogaster</em>, per <code>evo_rates</code>. The other code in the chunk below is to convert the output to look like that from the <code>scrm</code> R package, which can be easily processed by <code>jackalope</code>.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">scrm</span>)
<span class="co"># Function to run scrm for one chromosome and format output</span>
<span class="no">one_chrom</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">.size</span>) {
    <span class="no">ssites</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scrm/man/scrm.html">scrm</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/sprintf.html">sprintf</a></span>(<span class="st">"10 1 -t %.4f -r 1 %i -I 2 5 5 100"</span>, <span class="no">theta</span> * <span class="fl">4</span> * <span class="no">N0</span>, <span class="no">.size</span>))
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">ssites</span>$<span class="no">seg_sites</span><span class="kw">[[</span><span class="fl">1</span>]])
}
<span class="no">ssites</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">seg_sites</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">ref</span>$<span class="fu">sizes</span>(), <span class="no">one_chrom</span>))</pre></body></html></div>
<p>Using the previously created objects for molecular evolution information and the <code>haps_ssites</code> function, I create haplotypes from the reference genome:</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="no">haps</span> <span class="kw">&lt;-</span> <span class="fu">create_haplotypes</span>(<span class="no">ref</span>, <span class="fu">haps_ssites</span>(<span class="no">ssites</span>), <span class="no">sub</span>, <span class="no">ins</span>, <span class="no">del</span>)</pre></body></html></div>
<p>This results in the following set of haplotypes:</p>
<pre><code>#&gt;                               &lt;&lt; haplotypes object &gt;&gt;
#&gt; # Haplotypes: 10
#&gt; # Mutations: 2,682
#&gt; 
#&gt;                           &lt;&lt; Reference genome info: &gt;&gt;
#&gt; &lt; Set of 4 chromosomes &gt;
#&gt; # Total size: 985 bp
#&gt;   name                             chromosome                             length
#&gt; 2          GAAATCATGTCTTATAAAACGCCAAATC...TCCCCGCTTTCAAGACAGTCTCCTCGAC       252
#&gt; 3          TCCGTGATCATGCACAAGCATTGCAGTT...TCTAACGGGCGTCGGGCGAATGCTCGCA       240
#&gt; 4          CACGCGAGCTTACTATTGGTAATGCCTT...CACTTCGGAAGTCAGTTACCAGCTCCTC       253
#&gt; X          AGTCGATCGCAGACCGTCCTCCTGTAAG...ACACGTCACAGCCACGAAGGCTCACGGT       240</code></pre>
<p>For a file of true divergences from the reference genome, the <code>write_vcf</code> function writes the <code>haplotypes</code> object to a VCF file:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="fu">write_vcf</span>(<span class="no">haps</span>, <span class="st">"haplotypes"</span>)</pre></body></html></div>
<p>Lastly, I simulate 1 lane of <span class="math inline">\(2 \times 100\)</span>bp Illumina HiSeq 2500 sequencing. In this case, individuals within a population are pooled, and the population sequences are derived from are identified by barcodes.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu">illumina</span>(<span class="no">haps</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"haps_illumina"</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">500e6</span>, <span class="kw">paired</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">read_length</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">barcodes</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"AACCGCGG"</span>, <span class="fl">5</span>),
                                         <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="st">"GGTTATAA"</span>, <span class="fl">5</span>)))</pre></body></html></div>
<p>The below example instead has each individual haplotype’s reads output to separate FASTQ files:</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu">illumina</span>(<span class="no">haps</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"haps_illumina"</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">500e6</span>, <span class="kw">paired</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">read_length</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">sep_files</span> <span class="kw">=</span> <span class="fl">TRUE</span>)</pre></body></html></div>
<p>The <span class="math inline">\(F_{ST}\)</span> calculated from the resulting VCF file could then be compared to output from various programs to inform which works best in a particular case. For uncertain population parameters (e.g., migration rates), output from multiple calls to <code>scrm</code> varying the parameter of interest could be input to the <code>jackalope</code> pipeline above to identify the conditions under which one program might have an advantage over another.</p>
</div>
<div id="constructing-a-phylogeny" class="section level2">
<h2 class="hasAnchor">
<a href="#constructing-a-phylogeny" class="anchor"></a>Constructing a phylogeny</h2>
<div id="from-one-phylogenetic-tree" class="section level3">
<h3 class="hasAnchor">
<a href="#from-one-phylogenetic-tree" class="anchor"></a>From one phylogenetic tree</h3>
<p>This section shows how <code>jackalope</code> can generate haplotypes from a phylogeny, then simulate sequencing data from those haplotypes to test phylogeny reconstruction methods. First, I simulated a random species tree of 10 species, then scaled it to have a maximum tree depth of <span class="math inline">\(4 N_0\)</span> generations:</p>
<div class="sourceCode" id="cb18"><html><body><pre class="r"><span class="no">tree</span> <span class="kw">&lt;-</span> <span class="fu">rcoal</span>(<span class="fl">10</span>)
<span class="no">tree</span>$<span class="no">edge.length</span> <span class="kw">&lt;-</span> <span class="fl">4</span> * <span class="no">N0</span> * <span class="no">tree</span>$<span class="no">edge.length</span> / <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span>(<span class="fu">node.depth.edgelength</span>(<span class="no">tree</span>))</pre></body></html></div>
<p>Function <code>haps_phylo</code> organizes and checks the <code>tree</code> object, and including it with the mutation-type information allowed me to create haplotypes based on this phylogeny:</p>
<div class="sourceCode" id="cb19"><html><body><pre class="r"><span class="no">haps</span> <span class="kw">&lt;-</span> <span class="fu">create_haplotypes</span>(<span class="no">ref</span>, <span class="fu">haps_phylo</span>(<span class="no">tree</span>), <span class="no">sub</span>, <span class="no">ins</span>, <span class="no">del</span>)</pre></body></html></div>
<p>This results in the following <code>haplotypes</code> object:</p>
<pre><code>#&gt;                               &lt;&lt; haplotypes object &gt;&gt;
#&gt; # Haplotypes: 10
#&gt; # Mutations: 491
#&gt; 
#&gt;                           &lt;&lt; Reference genome info: &gt;&gt;
#&gt; &lt; Set of 4 chromosomes &gt;
#&gt; # Total size: 985 bp
#&gt;   name                             chromosome                             length
#&gt; 2          GAAATCATGTCTTATAAAACGCCAAATC...TCCCCGCTTTCAAGACAGTCTCCTCGAC       252
#&gt; 3          TCCGTGATCATGCACAAGCATTGCAGTT...TCTAACGGGCGTCGGGCGAATGCTCGCA       240
#&gt; 4          CACGCGAGCTTACTATTGGTAATGCCTT...CACTTCGGAAGTCAGTTACCAGCTCCTC       253
#&gt; X          AGTCGATCGCAGACCGTCCTCCTGTAAG...ACACGTCACAGCCACGAAGGCTCACGGT       240</code></pre>
<p>Now I can generate data for 1 flow cell of <span class="math inline">\(2 \times 250\)</span>bp sequencing on an Illumina MiSeq v3, where <code>haplotype_barcodes</code> is a character string that specifies the barcodes for each haplotype. I also wrote the true phylogenetic tree to a NEWICK file.</p>
<div class="sourceCode" id="cb21"><html><body><pre class="r"><span class="no">haplotype_barcodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"CTAGCTTG"</span>, <span class="st">"TCGATCCA"</span>, <span class="st">"ATACCAAG"</span>, <span class="st">"GCGTTGGA"</span>,
                        <span class="st">"CTTCACGG"</span>, <span class="st">"TCCTGTAA"</span>, <span class="st">"CCTCGGTA"</span>, <span class="st">"TTCTAACG"</span>,
                        <span class="st">"CGCTCGTG"</span>, <span class="st">"TATCTACA"</span>)
<span class="fu">illumina</span>(<span class="no">haps</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"phylo_tree"</span>, <span class="kw">seq_sys</span> <span class="kw">=</span> <span class="st">"MSv3"</span>,
         <span class="kw">paired</span> <span class="kw">=</span> <span class="fl">TRUE</span>, <span class="kw">read_length</span> <span class="kw">=</span> <span class="fl">250</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">50e6</span>,
         <span class="kw">barcodes</span> <span class="kw">=</span> <span class="no">haplotype_barcodes</span>)
<span class="kw pkg">ape</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/ape/man/write.tree.html">write.tree</a></span>(<span class="no">tree</span>, <span class="st">"true.tree"</span>)</pre></body></html></div>
<p>The true phylogenetic tree would then be compared to the final tree output from the program(s) the user chooses to test.</p>
</div>
<div id="from-gene-trees" class="section level3">
<h3 class="hasAnchor">
<a href="#from-gene-trees" class="anchor"></a>From gene trees</h3>
<p>Similar to the section above, the ultimate goal here is to test phylogeny reconstruction methods. The difference in this section is that instead of using a single, straightforward phylogeny, I use multiple gene trees per chromosome. In the species used in these simulations, species 1 diverged from 2 and 3 at <span class="math inline">\(t = 1.0\)</span>, where <span class="math inline">\(t\)</span> indicates time into the past and is in units of <span class="math inline">\(4 N_0\)</span> generations. Species 2 and 3 diverged at <span class="math inline">\(t = 0.5\)</span>. I assume a recombination rate of <span class="math inline">\(1 / (4 N_0)\)</span> recombination events per chromosome per generation. There are 4 diploid individuals sampled per species. I used the following code to call <code>scrm</code> to simulate the gene trees and create the object <code>gtrees</code>. And like the section using segregating sites, we have to wrap <code>lapply</code> inside <code><a href="https://rdrr.io/r/base/list.html">list(trees = ...)</a></code> to replicate the data structure from <code>scrm</code> for <code>jackalope</code> to use later.</p>
<div class="sourceCode" id="cb22"><html><body><pre class="r"><span class="co"># Run scrm for one chromosome size:</span>
<span class="no">one_chrom</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">.size</span>) {
    <span class="no">sims</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/scrm/man/scrm.html">scrm</a></span>(
        <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span>(<span class="st">"24 1"</span>,
              <span class="co"># Output gene trees:</span>
              <span class="st">"-T"</span>,
              <span class="co"># Recombination:</span>
              <span class="st">"-r 1"</span>, <span class="no">.size</span>,
              <span class="co"># 3 species with no ongoing migration:</span>
              <span class="st">"-I 3 8 8 8 0"</span>,
              <span class="co"># Species 2 derived from 1 at time 1.0:</span>
              <span class="st">"-ej 1.0 2 1"</span>,
              <span class="co"># Species 3 derived from 2 at time 0.5:</span>
              <span class="st">"-ej 0.5 3 2"</span>
        ))
    <span class="no">trees</span> <span class="kw">&lt;-</span> <span class="no">sims</span>$<span class="no">trees</span><span class="kw">[[</span><span class="fl">1</span>]]
    <span class="co"># scrm outputs branch lengths in units of 4*N0 generations, but we want just</span>
    <span class="co"># generations:</span>
    <span class="no">adjust_tree</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">.p</span>) {
        <span class="co"># Read to phylo object and adjust branch lengths:</span>
        <span class="no">.tr</span> <span class="kw">&lt;-</span> <span class="fu">read.tree</span>(<span class="kw">text</span> <span class="kw">=</span> <span class="no">.p</span>)
        <span class="no">.tr</span>$<span class="no">edge.length</span> <span class="kw">&lt;-</span> <span class="no">.tr</span>$<span class="no">edge.length</span> * <span class="fl">4</span> * <span class="no">N0</span>
        <span class="co"># "prefix" from `.p` showing how large the region this gene tree refers to is</span>
        <span class="no">prefix</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/strsplit.html">strsplit</a></span>(<span class="no">.p</span>, <span class="st">"\\]"</span>)<span class="kw">[[</span><span class="fl">1</span>]][<span class="fl">1</span>], <span class="st">"]"</span>)
        <span class="co"># Put back together into NEWICK text</span>
        <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="no">prefix</span>, <span class="fu">write.tree</span>(<span class="no">.tr</span>)))
    }
    <span class="no">trees</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="no">trees</span>, <span class="no">adjust_tree</span>)
    <span class="fu"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="no">trees</span>) <span class="kw">&lt;-</span> <span class="kw">NULL</span>
    <span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">trees</span>)
}
<span class="co"># For all chromosomes:</span>
<span class="no">gtrees</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">trees</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">lapply</a></span>(<span class="no">ref</span>$<span class="fu">sizes</span>(), <span class="no">one_chrom</span>))</pre></body></html></div>
<p>We can write the true gene trees using <code>write_gtrees</code> to an <code>ms</code>-style file:</p>
<div class="sourceCode" id="cb23"><html><body><pre class="r"><span class="fu">write_gtrees</span>(<span class="fu">haps_gtrees</span>(<span class="no">gtrees</span>), <span class="st">"gtrees"</span>)</pre></body></html></div>
<p>The <code>create_haplotypes</code> function uses these gene trees to create variant haplotypes. As for the other haplotype-creation methods, function <code>haps_gtrees</code> checks and organizes information from the <code>gtrees</code> object.</p>
<div class="sourceCode" id="cb24"><html><body><pre class="r"><span class="no">haps</span> <span class="kw">&lt;-</span> <span class="fu">create_haplotypes</span>(<span class="no">ref</span>, <span class="fu">haps_gtrees</span>(<span class="no">gtrees</span>),
                          <span class="no">sub</span>, <span class="no">ins</span>, <span class="no">del</span>)</pre></body></html></div>
<p>This results in the following <code>haplotypes</code> object:</p>
<pre><code>#&gt;                               &lt;&lt; haplotypes object &gt;&gt;
#&gt; # Haplotypes: 24
#&gt; # Mutations: 2,640
#&gt; 
#&gt;                           &lt;&lt; Reference genome info: &gt;&gt;
#&gt; &lt; Set of 4 chromosomes &gt;
#&gt; # Total size: 985 bp
#&gt;   name                             chromosome                             length
#&gt; 2          GAAATCATGTCTTATAAAACGCCAAATC...TCCCCGCTTTCAAGACAGTCTCCTCGAC       252
#&gt; 3          TCCGTGATCATGCACAAGCATTGCAGTT...TCTAACGGGCGTCGGGCGAATGCTCGCA       240
#&gt; 4          CACGCGAGCTTACTATTGGTAATGCCTT...CACTTCGGAAGTCAGTTACCAGCTCCTC       253
#&gt; X          AGTCGATCGCAGACCGTCCTCCTGTAAG...ACACGTCACAGCCACGAAGGCTCACGGT       240</code></pre>
<p>To store mutation information by diploid sample, the <code>write_vcf</code> function writes the <code>haplotypes</code> object to a VCF file. It assigns every other haplotype to a new diploid sample using a matrix for the <code>sample_matrix</code> argument:</p>
<div class="sourceCode" id="cb26"><html><body><pre class="r"><span class="fu">write_vcf</span>(<span class="no">haps</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"hap_gtrees"</span>,
          <span class="kw">sample_matrix</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fl">1</span>:<span class="no">haps</span>$<span class="fu">n_haps</span>(), <span class="kw">ncol</span> <span class="kw">=</span> <span class="fl">2</span>, <span class="kw">byrow</span> <span class="kw">=</span> <span class="fl">TRUE</span>))</pre></body></html></div>
<p>Next I generated data for 1 flow cell of <span class="math inline">\(2 \times 250\)</span>bp sequencing on an Illumina MiSeq v3, with barcodes in the object <code>haplotype_barcodes</code>.</p>
<div class="sourceCode" id="cb27"><html><body><pre class="r"><span class="co"># 2 of each barcode bc it's diploid</span>
<span class="no">haplotype_barcodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"TCGCCTTA"</span>, <span class="st">"CTAGTACG"</span>, <span class="st">"TTCTGCCT"</span>, <span class="st">"GCTCAGGA"</span>, <span class="st">"AGGAGTCC"</span>,
                            <span class="st">"CATGCCTA"</span>, <span class="st">"GTAGAGAG"</span>, <span class="st">"CCTCTCTG"</span>, <span class="st">"AGCGTAGC"</span>, <span class="st">"CAGCCTCG"</span>,
                            <span class="st">"TGCCTCTT"</span>, <span class="st">"TCCTCTAC"</span>), <span class="kw">each</span> <span class="kw">=</span> <span class="fl">2</span>)
<span class="fu">illumina</span>(<span class="no">haps</span>, <span class="kw">out_prefix</span> <span class="kw">=</span> <span class="st">"phylo_gtrees"</span>, <span class="kw">seq_sys</span> <span class="kw">=</span> <span class="st">"MSv3"</span>,
         <span class="kw">read_length</span> <span class="kw">=</span> <span class="fl">250</span>, <span class="kw">n_reads</span> <span class="kw">=</span> <span class="fl">50e6</span>, <span class="kw">paired</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
         <span class="kw">barcodes</span> <span class="kw">=</span> <span class="no">haplotype_barcodes</span>)</pre></body></html></div>
<p>Topologies of the gene trees would then be compared to final phylogenies output from software the user is interested in testing. Varying recombination rates or adding gene flow after separation of species would be natural extensions of these simulations.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Lucas A. Nell.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
